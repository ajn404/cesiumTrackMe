import{r as c}from"./index-DcuqsTuA.js";function C(n,e){const s=c.useRef([]);c.useEffect(()=>{var u,l,m;if(!n.current||!(e!=null&&e.apiKey)){console.warn("Viewer or API key is not provided");return}const t=a=>new Cesium.WebMapTileServiceImageryProvider({url:`https://{s}.tianditu.gov.cn/${a}_w/wmts?tk=${e.apiKey}`,layer:a,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],minimumLevel:e.minLevel||0,maximumLevel:e.maxLevel||18,credit:"Tianditu"});try{s.current.forEach(r=>{var i;(i=n.current)==null||i.imageryLayers.remove(r,!0)}),s.current=[];const{layers:a={}}=e;if(a.vector){const r=n.current.imageryLayers.addImageryProvider(t("vec"));s.current.push(r)}if(a.vectorAnnotation){const r=n.current.imageryLayers.addImageryProvider(t("cva"));s.current.push(r)}if(a.image){const r=n.current.imageryLayers.addImageryProvider(t("img"));s.current.push(r)}if(a.imageAnnotation){const r=n.current.imageryLayers.addImageryProvider(t("cia"));s.current.push(r)}if(a.terrain){const r=n.current.imageryLayers.addImageryProvider(t("ter"));s.current.push(r)}e.initialPosition&&n.current.camera.setView({destination:Cesium.Cartesian3.fromDegrees(e.initialPosition.longitude,e.initialPosition.latitude,e.initialPosition.height),orientation:{heading:Cesium.Math.toRadians(((u=e.initialOrientation)==null?void 0:u.heading)||0),pitch:Cesium.Math.toRadians(((l=e.initialOrientation)==null?void 0:l.pitch)||-90),roll:((m=e.initialOrientation)==null?void 0:m.roll)||0}})}catch(a){console.error("Failed to initialize TianDiTu:",a)}return()=>{s.current.forEach(a=>{var r;(r=n.current)==null||r.imageryLayers.remove(a,!0)})}},[n,e==null?void 0:e.apiKey,JSON.stringify(e==null?void 0:e.layers)])}function R(n,e={}){const s=c.useRef(null),t=c.useRef(),u=c.useRef(),l=c.useRef(),m=c.useRef(!1);return Cesium.Ion.defaultAccessToken=n,c.useEffect(()=>{var a;if(s.current&&!t.current){const r={terrainProvider:void 0,baseLayerPicker:!1,timeline:!1,animation:!1,fullscreenButton:!1,vrButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,navigationHelpButton:!1,requestRenderMode:!0,maximumRenderTimeChange:1e3},i=new Cesium.Viewer(s.current,{...r,...e,skyBox:e.skyBox?new Cesium.SkyBox({}):!1,skyAtmosphere:e.skyAtmosphere?new Cesium.SkyAtmosphere:!1});if((a=e.tianDiTu)!=null&&a.enabled&&(e.tianDiTu.token?C(t,{apiKey:e.tianDiTu.token,layers:{image:!0,imageAnnotation:!0}}):console.warn("Please provide a token for TianDiTu")),e.hideCredit&&(i.cesiumWidget.creditContainer.style.display="none"),e.defaultCamera){const{longitude:o,latitude:f,height:d,heading:y=0,pitch:g=-90,roll:h=0}=e.defaultCamera;i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(o,f,d),orientation:{heading:Cesium.Math.toRadians(y),pitch:Cesium.Math.toRadians(g),roll:Cesium.Math.toRadians(h)}})}return e.enableDrag===!1&&(i.scene.screenSpaceCameraController.enableRotate=!1,i.scene.screenSpaceCameraController.enableTranslate=!1,i.scene.screenSpaceCameraController.enableZoom=!1,i.scene.screenSpaceCameraController.enableTilt=!1,i.scene.screenSpaceCameraController.enableLook=!1),t.current=i,u.current=i.scene,l.current=i.camera,m.current=!0,()=>{t.current&&(t.current.destroy(),t.current=void 0,u.current=void 0,l.current=void 0,m.current=!1)}}},[]),{cesiumContainerRef:s,viewer:t,scene:u,camera:l,isReady:m}}export{C as a,R as u};
