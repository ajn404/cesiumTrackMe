import{r as c,j as d}from"./index-CyywMbe9.js";import{u as y}from"./useCesium-CTnXvPs4.js";function f(i,e){const t=c.useRef([]);c.useEffect(()=>{var s,u,l;if(!i.current||!(e!=null&&e.apiKey)){console.warn("Viewer or API key is not provided");return}const n=a=>new Cesium.WebMapTileServiceImageryProvider({url:`https://{s}.tianditu.gov.cn/${a}_w/wmts?tk=${e.apiKey}`,layer:a,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],minimumLevel:0,maximumLevel:e.maxLevel||18,credit:"Tianditu"});try{t.current.forEach(r=>{var m;(m=i.current)==null||m.imageryLayers.remove(r,!0)}),t.current=[];const{layers:a={}}=e;if(a.vector){const r=i.current.imageryLayers.addImageryProvider(n("vec"));t.current.push(r)}if(a.vectorAnnotation){const r=i.current.imageryLayers.addImageryProvider(n("cva"));t.current.push(r)}if(a.image){const r=i.current.imageryLayers.addImageryProvider(n("img"));t.current.push(r)}if(a.imageAnnotation){const r=i.current.imageryLayers.addImageryProvider(n("cia"));t.current.push(r)}if(a.terrain){const r=i.current.imageryLayers.addImageryProvider(n("ter"));t.current.push(r)}e.initialPosition&&i.current.camera.setView({destination:Cesium.Cartesian3.fromDegrees(e.initialPosition.longitude,e.initialPosition.latitude,e.initialPosition.height),orientation:{heading:Cesium.Math.toRadians(((s=e.initialOrientation)==null?void 0:s.heading)||0),pitch:Cesium.Math.toRadians(((u=e.initialOrientation)==null?void 0:u.pitch)||-90),roll:((l=e.initialOrientation)==null?void 0:l.roll)||0}})}catch(a){console.error("Failed to initialize TianDiTu:",a)}return()=>{t.current.forEach(a=>{var r;(r=i.current)==null||r.imageryLayers.remove(a,!0)})}},[i,e==null?void 0:e.apiKey,JSON.stringify(e==null?void 0:e.layers)])}function h(){const[i,e]=c.useState(null);c.useEffect(()=>{(async()=>{const u=await Cesium.createWorldTerrainAsync({});e(u)})()},[]);const{cesiumContainerRef:t,viewer:n}=y(void 0,{terrainProvider:i,shouldAnimate:!0,hideCredit:!0});return f(n,{apiKey:"fa4fa7129232846bfb71e9c37848b6df",initialPosition:{longitude:116.5389,latitude:39.8209,height:500},initialOrientation:{heading:0,pitch:-90,roll:0},minLevel:0,maxLevel:18,layers:{image:!0,imageAnnotation:!0}}),d.jsx("div",{className:"h-full w-full",children:d.jsx("div",{ref:t,className:"h-full w-full"})})}export{h as default};
