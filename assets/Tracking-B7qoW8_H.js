import{r as c,j as l}from"./index-CyywMbe9.js";import{u as S}from"./useCesium-CTnXvPs4.js";function b(t,u){const[s,a]=c.useState(!1),[e,n]=c.useState(),{trajectoryPoints:r,modelUrl:p,modelScale:f=2,pathColor:g=Cesium.Color.YELLOW,pointColor:y=Cesium.Color.RED,clockMultiplier:D=1}=u,T=c.useCallback(()=>{if(!t.current)return;const o=t.current.clock;o.startTime=Cesium.JulianDate.fromDate(new Date(r[0].time)),o.stopTime=Cesium.JulianDate.fromDate(new Date(r[r.length-1].time)),o.currentTime=Cesium.JulianDate.clone(o.startTime),o.clockRange=Cesium.ClockRange.LOOP_STOP,o.multiplier=D;const i=new Cesium.SampledPositionProperty;r.forEach(C=>{const k=Cesium.JulianDate.fromDate(new Date(C.time)),d=Cesium.Cartesian3.fromDegrees(C.lng,C.lat);i.addSample(k,d)});const m=t.current.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:o.startTime,stop:o.stopTime})]),model:{uri:p,scale:f,minimumPixelSize:64,maximumScale:200,clampAnimations:!1},position:i,orientation:new Cesium.VelocityOrientationProperty(i),point:new Cesium.PointGraphics({color:y,pixelSize:12,outlineColor:Cesium.Color.WHITE,outlineWidth:2}),path:new Cesium.PathGraphics({resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.3,color:g}),width:3})});t.current.trackedEntity=m,t.current.scene.screenSpaceCameraController.enableCollisionDetection=!1;const M=C=>{const k=C.currentTime,d=i.getValue(k);if(d){const x=Cesium.Cartographic.fromCartesian(d),P=Cesium.Math.toDegrees(x.longitude),E=Cesium.Math.toDegrees(x.latitude);n(A=>({lng:P,lat:E}))}};return t.current.clock.onTick.addEventListener(M),()=>{t.current&&(t.current.entities.remove(m),t.current.clock.onTick.removeEventListener(M))}},[t]);c.useEffect(()=>{if(!t.current)return;const o=t.current.entities.add({polyline:{positions:Cesium.Cartesian3.fromDegreesArray(r.flatMap(m=>[m.lng,m.lat])),width:1,material:Cesium.Color.GRAY.withAlpha(.5)}}),i=T();return()=>{t.current&&t.current.entities.remove(o),i==null||i()}},[T]);const h={play:()=>{t.current&&(t.current.clock.shouldAnimate=!0,a(!0))},pause:()=>{t.current&&(t.current.clock.shouldAnimate=!1,a(!1))},toggle:()=>{t.current&&(s?h.pause():(Cesium.JulianDate.compare(t.current.clock.currentTime,t.current.clock.stopTime)===0&&(t.current.clock.currentTime=t.current.clock.startTime),h.play()))},reset:()=>{t.current&&(t.current.clock.currentTime=t.current.clock.startTime,t.current.clock.shouldAnimate=!1,a(!1))}};return{isPlaying:s,currentPosition:e,controls:h}}const j={CESIUM_MAN:{url:"/cesiumTrackMe/assets/Cesium_Man.glb"}},L=(t=-117.16,u=32.71)=>{const s=[],a=new Date("2024-01-01T00:00:00Z").getTime();for(let e=0;e<200;e++){const n=e*.1,r=5e-4*n,p=t+r*(1+.3*Math.sin(5*n))*Math.cos(n)+(Math.random()-.5)*1e-4,f=u+r*(1+.3*Math.sin(5*n))*Math.sin(n)+(Math.random()-.5)*1e-4,g=a+e*5e3;s.push({time:g,lng:Number(p.toFixed(6)),lat:Number(f.toFixed(6))})}return s};function O(){const{cesiumContainerRef:t,viewer:u}=S(void 0,{targetFrameRate:30}),s=c.useMemo(()=>L(116.5389,39.8209),[]),{isPlaying:a,currentPosition:e,controls:n}=b(u,{trajectoryPoints:s,pathColor:Cesium.Color.YELLOW,clockMultiplier:1,modelUrl:j.CESIUM_MAN.url}),r=c.useMemo(()=>e?l.jsxs("div",{className:"mt-2",children:["经度: ",e.lng.toFixed(6),"纬度: ",e.lat.toFixed(6)]}):null,[e==null?void 0:e.lng.toFixed(6),e==null?void 0:e.lat.toFixed(6)]);return l.jsxs("div",{className:"h-full w-full relative",children:[l.jsx("div",{ref:t,className:"w-full h-full"}),l.jsxs("div",{className:"absolute top-5 left-5 z-10 bg-black/70 text-white p-3 rounded-lg",children:[l.jsx("button",{onClick:n.toggle,children:a?"⏸️ 暂停":"▶️ 播放"}),l.jsx("button",{onClick:n.reset,children:"⏹️ 重置"}),r]})]})}export{O as default};
