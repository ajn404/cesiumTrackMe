import{r as u}from"./index-BiwiOHEJ.js";function C(i,e){const n=u.useRef([]);u.useEffect(()=>{var c,s,l;if(!i.current||!(e!=null&&e.apiKey)){console.warn("Viewer or API key is not provided");return}if((e==null?void 0:e.apiKey)==="none")return;const t=a=>new Cesium.WebMapTileServiceImageryProvider({url:`https://{s}.tianditu.gov.cn/${a}_w/wmts?tk=${e.apiKey}`,layer:a,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],minimumLevel:e.minLevel||0,maximumLevel:e.maxLevel||18,credit:"Tianditu"});try{n.current.forEach(r=>{var m;(m=i.current)==null||m.imageryLayers.remove(r,!0)}),n.current=[];const{layers:a={}}=e;if(a.vector){const r=i.current.imageryLayers.addImageryProvider(t("vec"));n.current.push(r)}if(a.vectorAnnotation){const r=i.current.imageryLayers.addImageryProvider(t("cva"));n.current.push(r)}if(a.image){const r=i.current.imageryLayers.addImageryProvider(t("img"));n.current.push(r)}if(a.imageAnnotation){const r=i.current.imageryLayers.addImageryProvider(t("cia"));n.current.push(r)}if(a.terrain){const r=i.current.imageryLayers.addImageryProvider(t("ter"));n.current.push(r)}e.initialPosition&&i.current.camera.setView({destination:Cesium.Cartesian3.fromDegrees(e.initialPosition.longitude,e.initialPosition.latitude,e.initialPosition.height),orientation:{heading:Cesium.Math.toRadians(((c=e.initialOrientation)==null?void 0:c.heading)||0),pitch:Cesium.Math.toRadians(((s=e.initialOrientation)==null?void 0:s.pitch)||-90),roll:((l=e.initialOrientation)==null?void 0:l.roll)||0}})}catch(a){console.error("Failed to initialize TianDiTu:",a)}return()=>{n.current.forEach(a=>{var r;(r=i.current)==null||r.imageryLayers.remove(a,!0)})}},[i,e==null?void 0:e.apiKey,JSON.stringify(e==null?void 0:e.layers)])}function R(i,e={}){const n=u.useRef(null),t=u.useRef(),c=u.useRef(),s=u.useRef(),l=u.useRef(!1);return Cesium.Ion.defaultAccessToken=i,u.useEffect(()=>{if(n.current&&!t.current){const a={terrainProvider:void 0,baseLayerPicker:!1,timeline:!1,animation:!1,fullscreenButton:!1,vrButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,navigationHelpButton:!1,requestRenderMode:!0,maximumRenderTimeChange:1e3,sceneMode:Cesium.SceneMode.SCENE3D,useDefaultRenderLoop:!0},r=new Cesium.Viewer(n.current,{...a,...e,skyBox:e.skyBox?new Cesium.SkyBox({}):!1,skyAtmosphere:e.skyAtmosphere?new Cesium.SkyAtmosphere:!1});if(e.useDefaultRenderLoop!==void 0&&(r.useDefaultRenderLoop=e.useDefaultRenderLoop),e.hideCredit&&(r.cesiumWidget.creditContainer.style.display="none"),e.defaultCamera){const{longitude:m,latitude:f,height:d,heading:o=0,pitch:y=-90,roll:g=0}=e.defaultCamera;r.camera.setView({destination:Cesium.Cartesian3.fromDegrees(m,f,d),orientation:{heading:Cesium.Math.toRadians(o),pitch:Cesium.Math.toRadians(y),roll:Cesium.Math.toRadians(g)}})}return e.enableDrag===!1&&(r.scene.screenSpaceCameraController.enableRotate=!1,r.scene.screenSpaceCameraController.enableTranslate=!1,r.scene.screenSpaceCameraController.enableZoom=!1,r.scene.screenSpaceCameraController.enableTilt=!1,r.scene.screenSpaceCameraController.enableLook=!1),t.current=r,c.current=r.scene,s.current=r.camera,l.current=!0,()=>{t.current&&(t.current.destroy(),t.current=void 0,c.current=void 0,s.current=void 0,l.current=!1)}}},[]),C(t,{apiKey:e.tianDiTu&&e.tianDiTu.enabled?e.tianDiTu.token:"none",layers:{image:!0,imageAnnotation:!0}}),{cesiumContainerRef:n,viewer:t,scene:c,camera:s,isReady:l}}export{C as a,R as u};
