import{r as l,M as E,j as c}from"./index-DKSmqS4X.js";import{u as S}from"./useCesium-0ce6GpZQ.js";function j(t,u){const[s,a]=l.useState(!1),[o,e]=l.useState(),{trajectoryPoints:n,modelUrl:m,modelScale:p=2,pathColor:g=Cesium.Color.YELLOW,pointColor:D=Cesium.Color.RED,clockMultiplier:y=1}=u,k=l.useCallback(()=>{if(!t.current)return;const r=t.current.clock;r.startTime=Cesium.JulianDate.fromDate(new Date(n[0].time)),r.stopTime=Cesium.JulianDate.fromDate(new Date(n[n.length-1].time)),r.currentTime=Cesium.JulianDate.clone(r.startTime),r.clockRange=Cesium.ClockRange.LOOP_STOP,r.multiplier=y;const i=new Cesium.SampledPositionProperty;n.forEach(d=>{const T=Cesium.JulianDate.fromDate(new Date(d.time)),f=Cesium.Cartesian3.fromDegrees(d.lng,d.lat);i.addSample(T,f)});const C=t.current.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:r.startTime,stop:r.stopTime})]),model:{uri:m,scale:p,minimumPixelSize:64,maximumScale:200,clampAnimations:!1},position:i,orientation:new Cesium.VelocityOrientationProperty(i),point:new Cesium.PointGraphics({color:D,pixelSize:12,outlineColor:Cesium.Color.WHITE,outlineWidth:2}),path:new Cesium.PathGraphics({resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.3,color:g}),width:3})});t.current.trackedEntity=C,t.current.scene.screenSpaceCameraController.enableCollisionDetection=!1;const M=d=>{const T=d.currentTime,f=i.getValue(T);if(f){const x=Cesium.Cartographic.fromCartesian(f),P=Cesium.Math.toDegrees(x.longitude),b=Cesium.Math.toDegrees(x.latitude);e(N=>({lng:P,lat:b}))}};return t.current.clock.onTick.addEventListener(M),()=>{t.current&&(t.current.entities.remove(C),t.current.clock.onTick.removeEventListener(M))}},[t]);l.useEffect(()=>{if(!t.current)return;const r=t.current.entities.add({polyline:{positions:Cesium.Cartesian3.fromDegreesArray(n.flatMap(C=>[C.lng,C.lat])),width:1,material:Cesium.Color.GRAY.withAlpha(.5)}}),i=k();return()=>{t.current&&t.current.entities.remove(r),i==null||i()}},[k]);const h={play:()=>{t.current&&(t.current.clock.shouldAnimate=!0,a(!0))},pause:()=>{t.current&&(t.current.clock.shouldAnimate=!1,a(!1))},toggle:()=>{t.current&&(s?h.pause():(Cesium.JulianDate.compare(t.current.clock.currentTime,t.current.clock.stopTime)===0&&(t.current.clock.currentTime=t.current.clock.startTime),h.play()))},reset:()=>{t.current&&(t.current.clock.currentTime=t.current.clock.startTime,t.current.clock.shouldAnimate=!1,a(!1))}};return{isPlaying:s,currentPosition:o,controls:h}}const L={CESIUM_MAN:{url:"/cesiumTrackMe/assets/Cesium_Man.glb"}},A=(t=-117.16,u=32.71)=>{const s=[],a=new Date("2024-01-01T00:00:00Z").getTime();for(let o=0;o<200;o++){const e=o*.1,n=5e-4*e,m=t+n*(1+.3*Math.sin(5*e))*Math.cos(e)+(Math.random()-.5)*1e-4,p=u+n*(1+.3*Math.sin(5*e))*Math.sin(e)+(Math.random()-.5)*1e-4,g=a+o*5e3;s.push({time:g,lng:Number(m.toFixed(6)),lat:Number(p.toFixed(6))})}return s};function R(){const{mapProvider:t}=l.useContext(E),{cesiumContainerRef:u,viewer:s}=S(void 0,{targetFrameRate:30,tianDiTu:{enabled:t==="Tianditu",token:"fa4fa7129232846bfb71e9c37848b6df"}}),a=l.useMemo(()=>A(116.5389,39.8209),[]),{isPlaying:o,currentPosition:e,controls:n}=j(s,{trajectoryPoints:a,pathColor:Cesium.Color.YELLOW,clockMultiplier:1,modelUrl:L.CESIUM_MAN.url}),m=l.useMemo(()=>e?c.jsxs("div",{className:"mt-2",children:["经度: ",e.lng.toFixed(6),"纬度: ",e.lat.toFixed(6)]}):null,[e==null?void 0:e.lng.toFixed(6),e==null?void 0:e.lat.toFixed(6)]);return c.jsxs("div",{className:"h-full w-full relative",children:[c.jsx("div",{ref:u,className:"w-full h-full"}),c.jsxs("div",{className:"absolute top-5 left-5 z-10 bg-black/70 text-white p-3 rounded-lg",children:[c.jsx("button",{onClick:n.toggle,children:o?"⏸️ 暂停":"▶️ 播放"}),c.jsx("button",{onClick:n.reset,children:"⏹️ 重置"}),m]})]})}export{R as default};
